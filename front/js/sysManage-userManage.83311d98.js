"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[3764],{42011:function(e,a,t){t.r(a),t.d(a,{default:function(){return m}});var s=t(20641),l=t(72644);const i={class:"base-content"},o={class:"left-panel"},n={class:"right-panel"},r={class:"right-panel-search"},d={class:"base-pagination"};function c(e,a,t,c,u,h){const g=(0,s.g2)("el-button"),p=(0,s.g2)("el-input"),b=(0,s.g2)("el-header"),m=(0,s.g2)("el-table-column"),k=(0,s.g2)("el-switch"),f=(0,s.g2)("el-popconfirm"),w=(0,s.g2)("el-table"),_=(0,s.g2)("el-pagination"),y=(0,s.g2)("el-main"),C=(0,s.g2)("el-container"),v=(0,s.g2)("save-dialog"),$=(0,s.g2)("role-dialog"),F=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",i,[(0,s.bF)(C,null,{default:(0,s.k6)((()=>[(0,s.bF)(C,null,{default:(0,s.k6)((()=>[(0,s.bF)(b,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",o,[(0,s.bF)(g,{type:"primary",icon:"el-icon-plus",onClick:h.add},null,8,["onClick"]),(0,s.bF)(g,{type:"danger",plain:"",icon:"el-icon-delete",disabled:0==u.selection.length,onClick:h.batch_del},null,8,["disabled","onClick"]),(0,s.bF)(g,{type:"primary",plain:"",disabled:0==u.selection.length,onClick:h.batch_role},{default:(0,s.k6)((()=>[(0,s.eW)("分配角色")])),_:1},8,["disabled","onClick"]),(0,s.bF)(g,{type:"primary",plain:"",disabled:0==u.selection.length,onClick:h.batch_resetPwd},{default:(0,s.k6)((()=>[(0,s.eW)("密码重置")])),_:1},8,["disabled","onClick"])]),(0,s.Lk)("div",n,[(0,s.Lk)("div",r,[(0,s.bF)(p,{modelValue:u.search.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>u.search.keyword=e),placeholder:"登录账号 / 姓名",clearable:""},null,8,["modelValue"]),(0,s.bF)(g,{type:"primary",icon:"el-icon-search",onClick:h.initTable},null,8,["onClick"])])])])),_:1}),(0,s.bF)(y,{class:"nopadding"},{default:(0,s.k6)((()=>[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(w,{style:{width:"100%"},stripe:"",fit:"",size:"large",height:"500","header-row-class-name":"table-header-style",data:u.tableData,"row-key":"role_id",onSelectionChange:h.selectionChange},{default:(0,s.k6)((()=>[(0,s.bF)(m,{type:"selection",width:"50"}),(0,s.bF)(m,{prop:"account",label:"登录账号","show-overflow-tooltip":""}),(0,s.bF)(m,{prop:"nickname",label:"昵称","show-overflow-tooltip":""}),(0,s.bF)(m,{prop:"status",label:"状态"},{default:(0,s.k6)((e=>[(0,s.bF)(k,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,loading:e.row.$switch_status,"active-value":1,"inactive-value":0,"before-change":()=>h.beforeChangeDisposeStatus(e.row)},null,8,["modelValue","onUpdate:modelValue","loading","before-change"])])),_:1}),(0,s.bF)(m,{prop:"role_name",label:"角色","show-overflow-tooltip":""}),(0,s.bF)(m,{prop:"created_at",label:"创建时间"},{default:(0,s.k6)((e=>[(0,s.eW)((0,l.v_)(h.showTime(e.row.created_at)),1)])),_:1}),(0,s.bF)(m,{fixed:"right",label:"操作",width:"120"},{default:(0,s.k6)((e=>[(0,s.bF)(g,{link:"",size:"small",type:"primary",plain:"",onClick:a=>h.table_edit(e.row,e.$index)},{default:(0,s.k6)((()=>[(0,s.eW)("编辑")])),_:2},1032,["onClick"]),(0,s.bF)(f,{title:"确定删除吗？",onConfirm:a=>h.table_del(e.row,e.$index)},{reference:(0,s.k6)((()=>[(0,s.bF)(g,{link:"",size:"small",type:"danger",plain:""},{default:(0,s.k6)((()=>[(0,s.eW)("删除")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[F,u.tableLoading]]),(0,s.Lk)("div",d,[(0,s.bF)(_,{"current-page":u.pageIndex,"onUpdate:currentPage":a[1]||(a[1]=e=>u.pageIndex=e),"page-size":u.pageSize,"onUpdate:pageSize":a[2]||(a[2]=e=>u.pageSize=e),"page-sizes":[10,20,50],small:e.small,disabled:e.disabled,background:e.background,layout:"total, sizes, prev, pager, next, jumper",total:u.total,onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["current-page","page-size","small","disabled","background","total","onSizeChange","onCurrentChange"])])])),_:1})])),_:1})])),_:1})]),u.dialog.save?((0,s.uX)(),(0,s.Wv)(v,{key:0,ref:"saveDialog",onSuccess:h.handleSuccess,onClosed:a[3]||(a[3]=e=>u.dialog.save=!1)},null,8,["onSuccess"])):(0,s.Q3)("",!0),u.dialog.role?((0,s.uX)(),(0,s.Wv)($,{key:1,ref:"roleDialog",onSuccess:h.handleSuccess,onClosed:a[4]||(a[4]=e=>u.dialog.role=!1)},null,8,["onSuccess"])):(0,s.Q3)("",!0)],64)}var u=t(45440),h=t(39333),g={name:"user",components:{saveDialog:u["default"],roleDialog:h["default"]},data(){return{tableData:[],pageIndex:1,pageSize:10,total:400,tableLoading:!1,selection:[],search:{},dialog:{save:!1,role:!1}}},watch:{},mounted(){},computed:{showTime(){return e=>this.$moment(e).utc().format("YYYY-MM-DD HH:mm:ss")}},created(){this.initTable()},methods:{async initTable(){this.tableLoading=!0;let e={size:this.pageSize,page:this.pageIndex,keyword:this.search.keyword},a=await this.$API.sysManage.user.list.post(e);200==a.code?(this.tableLoading=!1,this.tableData=a.data.list,this.total=a.data.total):(this.tableLoading=!1,this.$message.error(a.message))},selectionChange(e){this.selection=e.map((e=>e.user_id))},add(){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open()}))},handleSuccess(e,a){("add"==a||"edit"==a||"role"==a)&&this.initTable()},async table_del(e){var a={user_ids:String(e.user_id)},t=await this.$API.sysManage.user.del.delete(a);200==t.code?(this.initTable(),this.$message.success("删除成功")):this.$alert(t.message,"提示",{type:"error"})},async batch_del(){this.$confirm(`确定删除选中的 ${this.selection.length} 项吗？`,"提示",{type:"warning"}).then((()=>{const e=this.$loading();var a={user_ids:this.selection.join(",")};this.$API.sysManage.user.del.delete(a).then((a=>{200==a.code?(e.close(),this.initTable(),this.$message.success("操作成功")):(e.close(),this.$message.error(a.message))}))})).catch((()=>{}))},table_edit(e){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("edit").setData(e)}))},async beforeChangeDisposeStatus(e){e.$switch_status=!0;let a={user_id:e.user_id,status:1==e.status?0:1},t=await this.$API.sysManage.user.upStatus.put(a);return 200==t.code?(e.$switch_status=!1,this.$message.success("处置成功!"),!0):(e.$switch_status=!1,this.$message.error("处置失败!"),!1)},batch_role(){this.dialog.role=!0,this.$nextTick((()=>{this.$refs.roleDialog.open("role").setData(this.selection)}))},async batch_resetPwd(){let e={user_ids:this.selection.join(","),reset_password_status:1},a=await this.$API.sysManage.user.pwdReset.post(e);200==a.code?this.$message.success("重置密码成功"):this.$message.error(a.message)}}},p=t(66262);const b=(0,p.A)(g,[["render",c]]);var m=b}}]);